<!-- FrontEnd/pages/stock/stock.html -->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Stock</title>
    <link rel="stylesheet" href="../../static/styles/styles.css" />
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="../provedor/provedor.html">Proveedores</a></li>
        <li><a href="../producto/producto.html">Productos</a></li>
      </ul>
    </nav>

    <section>
      <h2>Manejo de Stock</h2>

      <div>
        <strong>Total de Compras acumulado:</strong>
        <span id="total-compras"></span>
      </div>

      <form id="form-stock">
        <div>
          <label for="stock-proveedor">Proveedor:</label>
          <select id="stock-proveedor" required></select>
        </div>
        <div>
          <label for="stock-producto">Producto:</label>
          <select id="stock-producto" required></select>
        </div>
        <div>
          <label for="stock-cantidad">Cantidad:</label>
          <input type="number" id="stock-cantidad" min="1" required />
        </div>
        <div>
          <label>Acción:</label>
          <label><input type="radio" name="accion" value="comprar" checked />Comprar</label>
          <label><input type="radio" name="accion" value="devolver" />Devolver</label>
        </div>
        <button type="submit">Procesar</button>
      </form>
    </section>

    <script type="module">
      import {
        llenarSelectProveedores,
        llenarSelectProductosDeProveedor,
        comprarProducto,
        devolverProducto,
        getTotalCompras,
        setTotalCompras
      } from "../../../static/scripts/app.js";

      document.addEventListener("DOMContentLoaded", () => {
        const proveedorSelect = document.getElementById("stock-proveedor");
        const productoSelect = document.getElementById("stock-producto");
        const formStock = document.getElementById("form-stock");
        const spanTotalCompras = document.getElementById("total-compras");

        // Llenar combo de proveedores
        llenarSelectProveedores("stock-proveedor");
        // Actualizar campo "total compras"
        spanTotalCompras.textContent = getTotalCompras();

        // Cuando elija un proveedor, se llenan los productos correspondientes
        proveedorSelect.addEventListener("change", () => {
          llenarSelectProductosDeProveedor("stock-proveedor", "stock-producto");
        });

        // Evento submit para comprar/devolver
        formStock.addEventListener("submit", (e) => {
          e.preventDefault();
          const accion = document.querySelector('input[name="accion"]:checked').value;
          const productId = Number(productoSelect.value);
          const cantidad = Number(document.getElementById("stock-cantidad").value);

          if (!productId) {
            alert("Seleccione un producto válido.");
            return;
          }
          if (cantidad <= 0) {
            alert("La cantidad debe ser mayor que 0.");
            return;
          }

          if (accion === "comprar") {
            comprarProducto(productId, cantidad);
          } else {
            devolverProducto(productId, cantidad);
          }

          // Actualizar el total de compras en pantalla
          spanTotalCompras.textContent = getTotalCompras();
          formStock.reset();
        });
      });
    </script>
  </body>
</html>
